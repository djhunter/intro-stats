---
title: "Chapter 24: Inference for linear regression, continued"
output: 
  revealjs::revealjs_presentation:
    fig_width: 14 
    fig_height: 7
    self_contained: true
    theme: night
    highlight: zenburn
    css: slidesdjh.css
    center: false
    transition: slide
    reveal_options:
      controls: true
      progress: false
      width: 1080
      height: 540
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(comment = NA)
options(width = 100)
library(tidyverse)
library(openintro)
library(kableExtra)
theme_set(theme_bw())
set.seed(1423)
```

# Overview

- 24.4 Mathematical model for testing the slope
    - 24.4.1 Observed data
    - 24.4.2 Variability of the statistic
    - 24.4.3 Observed statistic vs. null statistics
- 24.5 Mathematical model, interval for the slope
    - 24.5.1 Observed data
    - 24.5.2 Variability of the statistic
- 24.6 Checking model conditions
    - 24.6.1 What are the technical conditions for the mathematical model?
    - 24.6.2 Why do we need technical conditions?
    - 24.6.3 What if all the technical conditions are met?

# Last time: regression inference

- Linear regression model: $y = \beta_0 + \beta_1x + \varepsilon$
- Regression equation: $\hat{y} = b_0 + b_1x$
- $b_0$ and $b_1$ are *statistics*.
    - $b_0$ is our best guess for the parameter $\beta_0$
    - $b_1$ is our best guess for the parameter $\beta_1$
- Null Hypothesis: No linear association
    - $H_0: \beta_1 = 0$
        - Regression slope is zero
    - $H_A: \beta_1 \neq 0$
        - Some linear association
        
## Randomization test for regression slope

- You have $n$ observations of two numeric variables, explanatory and response.
- Write the values of the response variable on $n$ cards.
- Shuffle, then randomly pair up with values of the explanatory variable.
- Compute a shuffled $b_1$. (lots)
- Make a null distribution.
- Get a p-value.


##  {data-background="https://openintro-ims.netlify.app/24-inf-model-slr_files/figure-html/permweightScatter-1.png" data-background-size="contain"}

##  {data-background="https://openintro-ims.netlify.app/24-inf-model-slr_files/figure-html/permweekslm-1.png" data-background-size="contain"}

##  {data-background="https://openintro-ims.netlify.app/24-inf-model-slr_files/figure-html/nulldistBirths-1.png" data-background-size="contain"}

# 24.4 Mathematical model for testing the slope

- We can get a $T$-statistic from the *correlation coefficient* $r$.
- This will have a $t$-distribution with $n-2$ degrees of freedom.
- Usually we will use software to get the $t$-statistic and P-value.

\[
T = \frac{r}{\sqrt{\frac{1-r^2}{n-2}}} = \frac{b_1 - 0}{SE_{b_1}}
\]

## 24.4.1 Observed data

- Midterm elections from 1898 to 2018.
- Explanatory: unemployment rate
- Response: percent change in House for president's party

**Research Question:** Can the unemployment rate predict how the president's party will do in the midterm elections?

## House-Midterms data set

```{r}
glimpse(midterms_house)
```

## Scatterplot and Regression Line

## Regression Table

```{r, message=FALSE, fig.width=5, fig.height=4, fig.align='center'}
ggplot(midterms_house, aes(x=unemp, y=house_change)) + 
  geom_point() +
  geom_smooth(method=lm)
```

## Influential Outliers

- There are two very influential outliers (high unemployment)
- These both took place during the depression:

```{r}
midterms_house %>% filter(unemp > 15)
```

## Remove outliers and replot

```{r, message=FALSE, fig.width=5, fig.height=4, fig.align='center'}
midhouse_nodep <- midterms_house %>% filter(unemp < 15)
ggplot(midhouse_nodep, aes(x=unemp, y=house_change)) + 
  geom_point() +
  geom_smooth(method=lm)
```

## 24.4.2 Variability of the statistic

```{r}
summary(lm(house_change ~ unemp, data = midhouse_nodep))
```

The data do not show much evidence that unemployment rate is associated with gains/losses in the midterm elections.

# Breakfast Cereal Ratings

Several variables were recorded on 74 different breakfast cereals: number of calories per serving, grams of protein, grams of fat, milligrams of sodium, grams of fiber, grams of carbohydrates, grams of sugars, milligrams of potassium, typical percentage of the FDA's RDA of vitamins, the weight of one serving, the number of cups in one serving, and the shelf location (1,2 or 3 for bottom, middle or top). A variable named "rating" was calculated by Consumer Reports.

## Sugar and Cereal Rating 

Is there a linear relationship between the sugar content of a cereal and its rating?

- Null Hypothesis: There is no association between sugar content and rating.
    + $H_0: \beta_1 = 0$
- Alternative Hypothesis: There is a linear relationship between between sugar content and rating.
    + $H_A: \beta_1 \neq 0$ 

## Group Activity

1. Paste the [CerealSugar](http://math.westmont.edu/data/cerealsugar.txt) data into the [Applet](http://www.rossmanchance.com/applets/RegShuffle.htm?hideExtras=2) and record the correlation coefficient $r$.

2. Find the $T$-statistic using the following formula.
\[
t = \frac{r}{\sqrt{\frac{1-r^2}{n-2}}} 
\]

3. Run a simulation with 1000 shuffles. Select the *t-statistic* radio button, then check the *Overlay t distribution* button. Does the t-distribution appear to do a good job of predicting the distribution of the simulated t-statistics? 

4. In the applet, click the box for *Regression Table*. This table provides the observed $T$-statistic for the data as well as the two-sided, theory-based test P-value. Compare the $T$-statistic to the value you calculated in #2. Record the P-value, along with an interpretation of its meaning in context.

## Regression table using R

```{r}
cerealsugar <- read.table("http://math.westmont.edu/data/cerealsugar.txt", header = TRUE)
summary(lm(rating ~ sugars, data = cerealsugar))
```

# 24.5 Mathematical model, interval for the slope
## 24.5.1 Observed data
## 24.5.2 Variability of the statistic
# 24.6 Checking model conditions
## 24.6.1 What are the technical conditions for the mathematical model?
## 24.6.2 Why do we need technical conditions?
## 24.6.3 What if all the technical conditions are met?


