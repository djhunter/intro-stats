---
title: "Chapter 1: Hello Data"
output: 
  revealjs::revealjs_presentation:
    fig_width: 14 
    fig_height: 7
    self_contained: true
    theme: night
    highlight: zenburn
    css: slidesdjh.css
    center: false
    transition: slide
    reveal_options:
      controls: true
      progress: false
      width: 1080
      height: 540
---

```{r setup, include=FALSE}
library(openintro)
library(tidyverse)
library(tools)
library(knitr)
library(kableExtra)
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(comment = NA)
options(width = 100)
```

# Overview

- 1.1 Case study: Using stents to prevent strokes
- 1.2 Data basics
    - 1.2.1 Observations, variables, and data matrices
    - 1.2.2 Types of variables
    - 1.2.3 Relationships between variables
    - 1.2.4 Explanatory and response variables
    - 1.2.5 Observational studies and experiments

# 1.1 Case study: Using stents to prevent strokes

> Does the use of stents reduce the risk of stroke?

-   **Treatment group**. Patients in the treatment group received a stent and medical management. The medical management included medications, management of risk factors, and help in lifestyle modification.
-   **Control group**. Patients in the control group received the same medical management as the treatment group, but they did not receive stents.

Researchers *randomly assigned* 224 patients to the treatment group and 227 to the control group.

## Group activity 

```{r stentStudyResultsDFsummary, echo=FALSE}
stent30_renamed <- stent30 %>% rename(`30 days` = outcome)
stent365_renamed <- stent365 %>% rename(`365 days` = outcome)
stent <- stent30_renamed %>%
  select(-group) %>%
  bind_cols(stent365_renamed) %>% 
  relocate(group) %>%
  mutate(
    group        = fct_rev(group),
    `30 days`    = fct_rev(`30 days`),
    `365 days`   = fct_rev(`365 days`),
  )

stent %>%
  mutate(group = str_to_title(group)) %>%
  pivot_longer(cols = c(`30 days`, `365 days`), 
               names_to = "stage", 
               values_to = "outcome") %>%
  count(group, stage, outcome) %>%
  pivot_wider(names_from = c(stage, outcome), values_from = n) %>%
  kable()
```

1. Of the 224 patients in the treatment group, 45 had a stroke by the end of the first year.
Using these two numbers, compute the proportion of patients in the treatment group who had a stroke by the end of their first year.

2. Compute the proportion of patients in the control group who had a stroke by the end of the first year.

3. What do these two *summary statistics* tell us about the *research question* "Does the use of stents reduce the risk of stroke?"

## Statistical investigations

Steps in a statistical investigation:

- Formulate a *research question*.
- Collect *data*.
- Summarize the data using *summary statistics*.
- *Interpret* the results in the context of the research question.

> Statistics is the study of how best to collect, analyze, and draw conclusions from data.

# 1.2 Data basics

## 1.2.1 Observations, variables, and data frames

- A *data frame* is a table (i.e., a spreadsheet).
    - Each row corresponds to an *observational unit*: the individual entities under consideration.
    - Each column corresponds to a *variable*: properties that can be observed on each observational unit.
    
```{r loan50-df, echo=FALSE}
loan50 %>% 
  select(loan_amount, interest_rate, term, grade, state, total_income, homeownership) %>%
  slice_head(n = 6) %>%
  kable()
```

## `county` Data Frame 

- Observational units: United States counties
- Variables: `r names(county)`

```{r echo=FALSE}
county[1:100,] %>% 
  kbl() %>%
  kable_styling(font_size = 12) %>%
  row_spec(0, background = "darkblue") %>%
  scroll_box(width = "100%", height = "300px")
```

##

```{r county-variables, echo=FALSE}
tribble(
  ~variable,           ~description,
  "name",              "Name of county.",
  "state",             "Name of state.",
  "pop2000",           "Population in 2000.",
  "pop2010",           "Population in 2010.",
  "pop2017",           "Population in 2017.",
  "pop_change",        "Population change from 2010 to 2017 (in percent).",
  "poverty",           "Percent of population in poverty in 2017.",
  "homeownership",     "Homeownership rate, 2006-2010.",
  "multi_unit",        "Multi-unit rate: percent of housing units that are in multi-unit structures, 2006-2010.",
  "unemployment_rate", "Unemployment rate in 2017.",
  "metro",             "Whether the county contains a metropolitan area, taking one of the values yes or no.",
  "median_edu",        "Median education level (2013-2017), taking one of the values below_hs, hs_diploma, some_college, or bachelors.", 
  "per_capita_income", "Per capita (per person) income (2013-2017).",
  "median_hh_income",  "Median household income.",
  "smoking_ban",       "Describes the type of county-level smoking ban in place in 2010, taking one of the values none, partial, or comprehensive."
) %>%
  kbl(row.names = TRUE) %>%
  kable_styling(font_size = 16) %>%
  scroll_box()
```

## 1.2.2 Types of variables

```{r, echo=FALSE}
par_og <- par(no.readonly = TRUE) # save original par
par(mar = rep(0, 4))
plot(c(-0.15, 1.3), 0:1, type = "n", axes = FALSE)

text(0.6, 0.9, "all variables", cex=2)
rect(0.4, 0.8, 0.8, 1)

text(0.25, 0.5, "numerical", cex=2)
rect(0.1, 0.4, 0.4, 0.6)
arrows(0.45, 0.78, 0.34, 0.62, length = 0.08)

text(0.9, 0.5, "categorical", cex=2)
rect(0.73, 0.4, 1.07, 0.6)
arrows(0.76, 0.78, 0.85, 0.62, length = 0.08)

text(0, 0.1, "discrete", cex=2)
rect(-0.17, 0, 0.17, 0.2)
arrows(0.13, 0.38, 0.05, 0.22, length = 0.08)

text(0.39, 0.1, "continuous", cex=2)
rect(0.25, 0, 0.53, 0.2)
arrows(0.35, 0.38, 0.4, 0.22, length = 0.08)

text(0.77, 0.105, "ordinal", cex=2)
rect(0.64, 0, 0.9, 0.2)
arrows(0.82, 0.38, 0.77, 0.22, length = 0.08)

text(1.12, 0.1, "nominal", cex=2)
rect(0.99, 0, 1.25, 0.2)
arrows(1.02, 0.38, 1.1, 0.22, length = 0.08)
par(par_og) # restore original par
```

## Group Activity

1. Data were collected about students in a statistics course. Three variables were recorded for each student: number of siblings, student height, and whether the student had previously taken a statistics course. Classify each of the variables as continuous numerical, discrete numerical, or categorical.

2. An experiment is evaluating the effectiveness of a new drug in treating migraines. A `group` variable is used to indicate the experiment group for each patient: treatment or control. The `num_migraines` variable represents the number of migraines the patient experienced during a 3-month period. Classify each variable as either numerical or categorical?

## 1.2.3 Relationships between variables

## Homeownership rate and multi-unit structures

- `homeownership`: the percentage of homes that are owned by residents
- `multi-unit`: the percentage of housing units that are in multi-unit structures (e.g., apartments, condos)

Are these two variables related?

```{r echo=FALSE}
county[1:300,] %>% 
  select(name, state, homeownership, multi_unit) %>%
  kbl() %>%
  kable_styling(font_size = 16) %>%
  row_spec(0, background = "darkblue") %>%
  scroll_box(width = "55%", height = "300px")
```

## {data-background-image="https://openintro-ims.netlify.app/01-data-hello_files/figure-html/county-multi-unit-homeownership-1.png" data-background-size="contain"}

## Associated Variables

- The multi-unit and homeownership rates are said to be *associated* because the plot shows a discernible pattern. 
    - The downward trend means the variables are *negatively associated*.
- When two variables show some connection with one another, they are called *associated variables*.
- If two variables are not associated, then they are said to be *independent*. That is, two variables are independent if there is no evident relationship between the two.

## 1.2.4 Explanatory and response variables

Suppose that $X$ and $Y$ are associated varaibles.

- If variable $X$ helps us explain or predict the value of variable $Y$, we say that $X$ is the *explanatory variable* and $Y$ is the *response variable*.
- Sometimes (not always) the explanatory variable affects the response variable, i.e., the change in one variable *causes* a change in the other.
    - **Example:** Does the median household income in a county cause its population size to change?
    
## {data-background-image="https://openintro-ims.netlify.app/01-data-hello_files/figure-html/county-pop-change-med-hh-income-1.png" data-background-size="contain"}

## 1.2.5 Observational studies and experiments

There are two primary types of data collection: *experiments* and *observational studies*.

- In an *experiment*, researchers put subjects in two or more groups and compare them.
    - In a *randomized experiment*, researchers randomly assign the groups. (e.g., stent study)
- In an *observational study*, researchers collect data in a way that does not directly interfere with how the data arise. (e.g, `county` data set).
-  Beware: **Association** $\neq$ **Causation.**
    - Observational studies cannot determine causation (e.g., TV's predict life expectancy)
    - Well-designed randomized experiments can prove causation.

# Group Discussion

## Air pollution 

Researchers collected data to examine the relationship between air pollutants and preterm births in Southern California.
During the study air pollution levels were measured by air quality monitoring stations.
Specifically, levels of carbon monoxide were recorded in parts per million, nitrogen dioxide and ozone in parts per hundred million, and coarse particulate matter (PM$_{10}$) in $\mu g/m^3$.
Length of gestation data were collected on 143,196 births between the years 1989 and 1993, and air pollution exposure during gestation was calculated for each birth.
The analysis suggested that increased ambient PM$_{10}$ and, to a lesser degree, CO concentrations may be associated with the occurrence of preterm births. 

---

<div class = "column-left">
1.  Identify the main research question of the study.
2.  Who are the subjects (observational units) in this study, and how many are included?
3.  What are the variables in the study? Identify each variable as numerical or categorical. 
4. Which is the explanatory variable, and which is the response?
5. Was this study an experiment or an observational study?
</div>

<div class = "column-right">
<small>
Researchers collected data to examine the relationship between air pollutants and preterm births in Southern California. During the study air pollution levels were measured by air quality monitoring stations. Specifically, levels of carbon monoxide were recorded in parts per million, nitrogen dioxide and ozone in parts per hundred million, and coarse particulate matter (PM$_{10}$) in $\mu g/m^3$. Length of gestation data were collected on 143,196 births between the years 1989 and 1993, and air pollution exposure during gestation was calculated for each birth. The analysis suggested that increased ambient PM$_{10}$ and, to a lesser degree, CO concentrations may be associated with the occurrence of preterm births.  
</small>
</div>

---



## Migraines and acupuncture

A migraine is a particularly painful type of headache, which patients sometimes wish to treat with acupuncture. 
To determine whether acupuncture relieves migraine pain, researchers conducted a randomized controlled study where 89 individuals who identified as female diagnosed with migraine headaches were randomly assigned to one of two groups: treatment or control. 
Forty-three (43) patients in the treatment group received acupuncture that is specifically designed to treat migraines. 
Forty-six (46) patients in the control group received placebo acupuncture (needle insertion at non-acupoint locations). 
Twenty-four (24) hours after patients received acupuncture, they were asked if they were pain free. 
Results are summarized in the contingency table below. 
Also provided is a figure from the original paper displaying the appropriate area (M) versus the inappropriate area (S) used in the treatment of migraine attacks.

## {data-background-image="https://openintro-ims.netlify.app/exercises/images/earacupuncture.png" data-background-size="contain"}

---

```{r echo=FALSE, message=FALSE}
migraine %>%
  mutate(
    group = toTitleCase(as.character(group)),
    pain_free = toTitleCase(as.character(pain_free))
  ) %>%
  count(group, pain_free) %>%
  pivot_wider(names_from = pain_free, values_from = n) %>%
  rename(Group = group) %>%
  kbl(linesep = "", booktabs = TRUE) %>%
  kable_styling(bootstrap_options = c("striped", "condensed"), 
                latex_options = "HOLD_position",
                full_width = FALSE) %>%
  add_header_above(c("", "Pain free?" = 2)) %>%
  column_spec(1:3, width = "5em")
```

1.  What percent of patients in the treatment group were pain free 24 hours after receiving acupuncture?

2.  What percent were pain free in the control group?

3.  In which group did a higher percent of patients become pain free 24 hours after receiving acupuncture?

4. What are the explanatory and response variables in this study? Classify each as numerical or categorical.

--- 

5.  Your findings so far might suggest that acupuncture is an effective treatment for migraines for all people who suffer from migraines. However, this is not the only possible conclusion. What is one other possible explanation for the observed difference between the percentages of patients that are pain free 24 hours after receiving acupuncture in the two groups?
    


